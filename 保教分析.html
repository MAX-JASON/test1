<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿éšªé‡åŒ–åˆ†æå·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: white;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .tool-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 30px 60px rgba(0,0,0,0.2);
        }

        .tool-card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2d3748;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin: 20px 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .result-section {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f4f8 100%);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #667eea;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: bold;
            color: #4a5568;
        }

        .result-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f1f1f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .gap-fill {
            background: linear-gradient(90deg, #f44336, #d32f2f);
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-3d {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
        }

        .health-meter {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .meter {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(from 180deg, #ff4444 0deg, #ffaa00 120deg, #44ff44 240deg, #44ff44 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .meter-inner {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .meter-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .meter-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .tabs {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-weight: bold;
        }

        .tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .icon {
            font-size: 2em;
            margin-bottom: 15px;
            display: block;
            text-align: center;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .tool-grid {
                grid-template-columns: 1fr;
            }
            .grid-2 {
                grid-template-columns: 1fr;
            }
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="floating">ğŸ›¡ï¸ ä¿éšªé‡åŒ–åˆ†æå·¥å…·</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">ğŸ’° å£½éšªç¼ºå£åˆ†æ</div>
            <div class="tab" onclick="switchTab(1)">ğŸ¥ é†«ç™‚é•·ç…§é ä¼°</div>
            <div class="tab" onclick="switchTab(2)">ğŸ“Š ä¿è²»å¥åº·åº¦</div>
            <div class="tab" onclick="switchTab(3)">ğŸ“ˆ ç¾é‡‘åƒ¹å€¼åˆ†æ</div>
        </div>

        <!-- å£½éšªä¿éšœç¼ºå£è¨ˆç®—å™¨ -->
        <div class="tab-content active" id="tab-0">
            <div class="tool-card">
                <h2><span class="icon">ğŸ’°</span>å£½éšªä¿éšœç¼ºå£åˆ†æ (D.I.M.E. æ³•å‰‡)</h2>
                
                <div class="grid-2">
                    <div>
                        <div class="input-group">
                            <label for="debt">ğŸ’³ å®¶åº­å‚µå‹™ç¸½é¡ (è¬å…ƒ)</label>
                            <input type="number" id="debt" value="500" oninput="calculateDIME()">
                        </div>
                        
                        <div class="input-group">
                            <label for="incomeYears">ğŸ“… éœ€ä¿éšœå¹´æ•¸</label>
                            <input type="number" id="incomeYears" value="10" oninput="calculateDIME()">
                        </div>
                        
                        <div class="input-group">
                            <label for="annualIncome">ğŸ’µ å®¶åº­å¹´æ”¶å…¥ (è¬å…ƒ)</label>
                            <input type="number" id="annualIncome" value="100" oninput="calculateDIME()">
                        </div>
                        
                        <div class="input-group">
                            <label for="mortgage">ğŸ  æˆ¿è²¸é¤˜é¡ (è¬å…ƒ)</label>
                            <input type="number" id="mortgage" value="800" oninput="calculateDIME()">
                        </div>
                        
                        <div class="input-group">
                            <label for="education">ğŸ“ å­å¥³æ•™è‚²åŸºé‡‘ (è¬å…ƒ)</label>
                            <input type="number" id="education" value="200" oninput="calculateDIME()">
                        </div>
                        
                        <div class="input-group">
                            <label for="currentLifeInsurance">ğŸ›¡ï¸ ç¾æœ‰å£½éšªä¿é¡ (è¬å…ƒ)</label>
                            <input type="number" id="currentLifeInsurance" value="300" oninput="calculateDIME()">
                        </div>
                    </div>
                    
                    <div>
                        <div class="result-section">
                            <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“Š åˆ†æçµæœ</h3>
                            <div class="result-item">
                                <span class="result-label">ç¸½éœ€æ±‚ä¿éšœé¡</span>
                                <span class="result-value" id="totalDemand">0 è¬å…ƒ</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å£½éšªä¿éšœç¼ºå£</span>
                                <span class="result-value" id="gap">0 è¬å…ƒ</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="gapBar" style="width: 0%;">è¼‰å…¥ä¸­...</div>
                            </div>
                            <div id="gapAdvice" class="warning" style="display: none;"></div>
                        </div>
                        
                        <div class="chart-container">
                            <canvas id="dimeChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é†«ç™‚/é•·ç…§è²»ç”¨é ä¼° -->
        <div class="tab-content" id="tab-1">
            <div class="tool-card">
                <h2><span class="icon">ğŸ¥</span>é†«ç™‚/é•·ç…§è²»ç”¨é ä¼°èˆ‡ä¿éšœæ¯”å°</h2>
                
                <div class="grid-2">
                    <div>
                        <div class="input-group">
                            <label for="age">ğŸ‘¤ ç›®å‰å¹´é½¡</label>
                            <input type="number" id="age" value="40" oninput="calculateMedicalLTC()">
                        </div>
                        
                        <div class="input-group">
                            <label for="expectedLife">ğŸ“Š é æœŸå£½å‘½</label>
                            <input type="number" id="expectedLife" value="85" oninput="calculateMedicalLTC()">
                        </div>
                        
                        <div class="input-group">
                            <label for="avgHospitalStayCost">ğŸ¥ æ¯æ¬¡ä½é™¢å¹³å‡èŠ±è²» (è¬å…ƒ)</label>
                            <input type="number" id="avgHospitalStayCost" value="8" step="0.1" oninput="calculateMedicalLTC()">
                        </div>
                        
                        <div class="input-group">
                            <label for="avgHospitalStays">ğŸ“ˆ æ¯å¹´é è¨ˆä½é™¢æ¬¡æ•¸</label>
                            <input type="number" id="avgHospitalStays" value="1" step="0.1" oninput="calculateMedicalLTC()">
                        </div>
                        
                        <div class="input-group">
                            <label for="ltcYears">ğŸ¤ é è¨ˆé•·ç…§å¹´æ•¸</label>
                            <input type="number" id="ltcYears" value="8" oninput="calculateMedicalLTC()">
                        </div>
                        
                        <div class="input-group">
                            <label for="monthlyLTCcost">ğŸ’° æ¯æœˆé•·ç…§è²»ç”¨ (è¬å…ƒ)</label>
                            <input type="number" id="monthlyLTCcost" value="3.5" step="0.1" oninput="calculateMedicalLTC()">
                        </div>
                        
                        <div class="input-group">
                            <label for="currentMedicalLTCcoverage">ğŸ›¡ï¸ ç¾æœ‰é†«ç™‚/é•·ç…§éšªä¿é¡ (è¬å…ƒ)</label>
                            <input type="number" id="currentMedicalLTCcoverage" value="200" oninput="calculateMedicalLTC()">
                        </div>
                    </div>
                    
                    <div>
                        <div class="result-section">
                            <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“Š è²»ç”¨é ä¼°çµæœ</h3>
                            <div class="result-item">
                                <span class="result-label">é ä¼°ç¸½é†«ç™‚è²»ç”¨</span>
                                <span class="result-value" id="estimatedMedical">0 è¬å…ƒ</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">é ä¼°ç¸½é•·ç…§è²»ç”¨</span>
                                <span class="result-value" id="estimatedLTC">0 è¬å…ƒ</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ç¾æœ‰ä¿éšœé è¨ˆçµ¦ä»˜</span>
                                <span class="result-value" id="coveredAmount">0 è¬å…ƒ</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">ç¸½ä¿éšœç¼ºå£</span>
                                <span class="result-value" id="totalMedicalLTCGap">0 è¬å…ƒ</span>
                            </div>
                            <div id="medicalAdvice" class="warning" style="display: none;"></div>
                        </div>
                        
                        <div class="chart-container">
                            <div class="chart-3d" id="medical3DChart"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¿è²»å¥åº·åº¦ -->
        <div class="tab-content" id="tab-2">
            <div class="tool-card">
                <h2><span class="icon">ğŸ“Š</span>ä¿è²»å¥åº·åº¦èˆ‡CPå€¼è©•åˆ†</h2>
                
                <div class="grid-2">
                    <div>
                        <div class="input-group">
                            <label for="annualHouseholdIncome">ğŸ’° å®¶åº­å¹´ç¸½æ”¶å…¥ (è¬å…ƒ)</label>
                            <input type="number" id="annualHouseholdIncome" value="100" oninput="calculatePremiumHealth()">
                        </div>
                        
                        <div class="input-group">
                            <label for="annualTotalPremium">ğŸ’³ å®¶åº­å¹´ç¸½ä¿è²»æ”¯å‡º (è¬å…ƒ)</label>
                            <input type="number" id="annualTotalPremium" value="12" oninput="calculatePremiumHealth()">
                        </div>
                        
                        <h3 style="margin: 20px 0;">ğŸ† ä¿å–®CPå€¼è©•åˆ†</h3>
                        
                        <div class="input-group">
                            <label for="policyName">ğŸ“‹ ä¿å–®åç¨±</label>
                            <input type="text" id="policyName" value="çµ‚èº«é†«ç™‚éšªA">
                        </div>
                        
                        <div class="input-group">
                            <label for="policyA_premium">ğŸ’° å¹´ç¹³ä¿è²» (è¬å…ƒ)</label>
                            <input type="number" id="policyA_premium" value="4" oninput="calculateCPV()">
                        </div>
                        
                        <div class="input-group">
                            <label for="policyA_coverage">ğŸ›¡ï¸ ç¸½ä¿é¡/ç†è³ ä¸Šé™ (è¬å…ƒ)</label>
                            <input type="number" id="policyA_coverage" value="200" oninput="calculateCPV()">
                        </div>
                        
                        <div class="input-group">
                            <label for="policyA_scope">ğŸ“Š ä¿éšœç¯„åœå»£åº¦ (1-5åˆ†)</label>
                            <select id="policyA_scope" onchange="calculateCPV()">
                                <option value="1">1åˆ† - ä¿éšœç¯„åœå¾ˆçª„</option>
                                <option value="2">2åˆ† - ä¿éšœç¯„åœåçª„</option>
                                <option value="3" selected>3åˆ† - ä¿éšœç¯„åœé©ä¸­</option>
                                <option value="4">4åˆ† - ä¿éšœç¯„åœåå»£</option>
                                <option value="5">5åˆ† - ä¿éšœç¯„åœå¾ˆå»£</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <div class="health-meter">
                            <div class="meter pulse">
                                <div class="meter-inner">
                                    <div class="meter-value" id="premiumPercentage">0%</div>
                                    <div class="meter-label">ä¿è²»ä½”æ”¶å…¥æ¯”</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="result-section">
                            <div class="result-item">
                                <span class="result-label">å»ºè­°å€é–“</span>
                                <span class="result-value">10% - 15%</span>
                            </div>
                            <div id="premiumAdvice" class="success">è«‹è¼¸å…¥æ•¸æ“šé€²è¡Œåˆ†æ</div>
                        </div>
                        
                        <div class="result-section" style="margin-top: 20px;">
                            <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ† CPå€¼åˆ†æ</h3>
                            <div class="result-item">
                                <span class="result-label">CPå€¼åˆ†æ•¸</span>
                                <span class="result-value" id="cpvScore">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="cpvBar" style="width: 0%;">CPå€¼è©•ä¼°ä¸­...</div>
                            </div>
                            <div id="cpvAdvice" class="success">CPå€¼è¶Šé«˜ä»£è¡¨æ€§åƒ¹æ¯”è¶Šå¥½</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¾é‡‘åƒ¹å€¼åˆ†æ -->
        <div class="tab-content" id="tab-3">
            <div class="tool-card">
                <h2><span class="icon">ğŸ“ˆ</span>ç¾é‡‘åƒ¹å€¼æˆé•·èˆ‡é€šè†¨æ¯”è¼ƒåˆ†æ</h2>
                
                <div class="grid-2">
                    <div>
                        <div class="input-group">
                            <label for="annualPremium">ğŸ’° å¹´ç¹³ä¿è²» (è¬å…ƒ)</label>
                            <input type="number" id="annualPremium" value="10" oninput="generateChartData()">
                        </div>
                        
                        <div class="input-group">
                            <label for="paymentYears">ğŸ“… ç¹³è²»å¹´æœŸ</label>
                            <input type="number" id="paymentYears" value="20" oninput="generateChartData()">
                        </div>
                        
                        <div class="input-group">
                            <label for="expectedReturnRate">ğŸ“Š ä¿å–®é æœŸå¹´å ±é…¬ç‡ (%)</label>
                            <input type="number" id="expectedReturnRate" step="0.1" value="2.5" oninput="generateChartData()">
                        </div>
                        
                        <div class="input-group">
                            <label for="inflationRate">ğŸ“ˆ é æœŸå¹´é€šè†¨ç‡ (%)</label>
                            <input type="number" id="inflationRate" step="0.1" value="2.0" oninput="generateChartData()">
                        </div>
                        
                        <div class="input-group">
                            <label for="analysisYears">ğŸ” åˆ†æç¸½å¹´æœŸ</label>
                            <input type="number" id="analysisYears" value="30" oninput="generateChartData()">
                        </div>
                        
                        <div class="result-section">
                            <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ’¡ é‡è¦æŒ‡æ¨™</h3>
                            <div class="result-item">
                                <span class="result-label">ç¸½ç¹³ä¿è²»</span>
                                <span class="result-value" id="totalPremiumPaid">0 è¬å…ƒ</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">é ä¼°ç¾é‡‘åƒ¹å€¼</span>
                                <span class="result-value" id="finalCashValue">0 è¬å…ƒ</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">å¯¦è³ªè³¼è²·åŠ›</span>
                                <span class="result-value" id="realValue">0 è¬å…ƒ</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">æŠ•è³‡å ±é…¬ç‡</span>
                                <span class="result-value" id="roi">0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="chart-container">
                            <canvas id="cashValueChart" width="500" height="400"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dimeChart, cashValueChart;
        let scene, camera, renderer;
        
        // æ¨™ç±¤åˆ‡æ›åŠŸèƒ½
        function switchTab(index) {
            // ç§»é™¤æ‰€æœ‰activeé¡åˆ¥
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // æ·»åŠ activeé¡åˆ¥åˆ°é¸ä¸­çš„æ¨™ç±¤
            document.querySelectorAll('.tab')[index].classList.add('active');
            document.getElementById(`tab-${index}`).classList.add('active');
            
            // æ ¹æ“šä¸åŒæ¨™ç±¤åŸ·è¡Œç›¸æ‡‰çš„åˆå§‹åŒ–
            setTimeout(() => {
                switch(index) {
                    case 0:
                        calculateDIME();
                        break;
                    case 1:
                        calculateMedicalLTC();
                        break;
                    case 2:
                        calculatePremiumHealth();
                        calculateCPV();
                        break;
                    case 3:
                        generateChartData();
                        break;
                }
            }, 100);
        }

        // 1. å£½éšªä¿éšœç¼ºå£è¨ˆç®—
        function calculateDIME() {
            const debt = parseFloat(document.getElementById('debt').value) || 0;
            const incomeYears = parseFloat(document.getElementById('incomeYears').value) || 0;
            const annualIncome = parseFloat(document.getElementById('annualIncome').value) || 0;
            const mortgage = parseFloat(document.getElementById('mortgage').value) || 0;
            const education = parseFloat(document.getElementById('education').value) || 0;
            const currentLifeInsurance = parseFloat(document.getElementById('currentLifeInsurance').value) || 0;

            // å¢å¼·ç‰ˆDIMEè¨ˆç®—ï¼šåŠ å…¥ç·Šæ€¥é å‚™é‡‘(6å€‹æœˆæ”¶å…¥)å’Œé€šè†¨èª¿æ•´å› å­(1.03)
            const emergencyFund = annualIncome * 0.5;
            const inflationFactor = 1.03;
            const totalDemand = (debt + (incomeYears * annualIncome * inflationFactor) + mortgage + education + emergencyFund);
            const gap = totalDemand - currentLifeInsurance;

            document.getElementById('totalDemand').textContent = totalDemand.toLocaleString() + ' è¬å…ƒ';
            document.getElementById('gap').textContent = gap.toLocaleString() + ' è¬å…ƒ';

            let coveragePercentage = totalDemand > 0 ? (currentLifeInsurance / totalDemand) * 100 : 0;
            if (coveragePercentage > 100) coveragePercentage = 100;

            const gapBar = document.getElementById('gapBar');
            const adviceDiv = document.getElementById('gapAdvice');
            
            gapBar.style.width = coveragePercentage + '%';
            
            if (gap > 0) {
                gapBar.style.background = 'linear-gradient(90deg, #f44336, #d32f2f)';
                gapBar.textContent = `ä¿éšœä¸è¶³ ${gap.toLocaleString()} è¬å…ƒ`;
                adviceDiv.className = 'danger';
                adviceDiv.textContent = `âš ï¸ å»ºè­°å¢åŠ  ${gap.toLocaleString()} è¬å…ƒå£½éšªä¿éšœï¼Œä»¥ç¢ºä¿å®¶åº­è²¡å‹™å®‰å…¨ã€‚`;
                adviceDiv.style.display = 'block';
            } else if (gap < 0) {
                gapBar.style.background = 'linear-gradient(90deg, #4CAF50, #45a049)';
                gapBar.textContent = `ä¿éšœå……è¶³ï¼Œè¶…é¡ ${Math.abs(gap).toLocaleString()} è¬å…ƒ`;
                adviceDiv.className = 'success';
                adviceDiv.textContent = `âœ… æ­å–œï¼æ‚¨çš„å£½éšªä¿éšœå……è¶³ï¼Œè¶…å‡ºéœ€æ±‚ ${Math.abs(gap).toLocaleString()} è¬å…ƒã€‚`;
                adviceDiv.style.display = 'block';
            } else {
                gapBar.style.background = 'linear-gradient(90deg, #4CAF50, #45a049)';
                gapBar.textContent = 'ä¿éšœå‰›å¥½å……è¶³';
                adviceDiv.className = 'success';
                adviceDiv.textContent = 'âœ… æ‚¨çš„å£½éšªä¿éšœå‰›å¥½ç¬¦åˆéœ€æ±‚ï¼Œè²¡å‹™è¦åŠƒè‰¯å¥½ï¼';
                adviceDiv.style.display = 'block';
            }

            // æ›´æ–°åœ“é¤…åœ–
            updateDIMEChart(debt, incomeYears * annualIncome, mortgage, education, currentLifeInsurance);
        }

        function updateDIMEChart(debt, income, mortgage, education, coverage) {
            const ctx = document.getElementById('dimeChart').getContext('2d');
            
            if (dimeChart) {
                dimeChart.destroy();
            }

            const totalNeed = debt + income + mortgage + education;
            
            dimeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['å‚µå‹™', 'æ”¶å…¥ä¿éšœ', 'æˆ¿è²¸', 'æ•™è‚²åŸºé‡‘', 'ç¾æœ‰ä¿éšœ'],
                    datasets: [{
                        data: [debt, income, mortgage, education, coverage],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB', 
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'D.I.M.E. ä¿éšœéœ€æ±‚åˆ†æ',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // 2. é†«ç™‚/é•·ç…§è²»ç”¨è¨ˆç®—
        function calculateMedicalLTC() {
            const age = parseFloat(document.getElementById('age').value) || 0;
            const expectedLife = parseFloat(document.getElementById('expectedLife').value) || 0;
            const avgHospitalStayCost = parseFloat(document.getElementById('avgHospitalStayCost').value) || 0;
            const avgHospitalStays = parseFloat(document.getElementById('avgHospitalStays').value) || 0;
            const ltcYears = parseFloat(document.getElementById('ltcYears').value) || 0;
            const monthlyLTCcost = parseFloat(document.getElementById('monthlyLTCcost').value) || 0;
            const currentMedicalLTCcoverage = parseFloat(document.getElementById('currentMedicalLTCcoverage').value) || 0;

            // å¢å¼·ç‰ˆé†«ç™‚è¨ˆç®—ï¼šåŠ å…¥é†«ç™‚é€šè†¨ç‡(5%)å’Œåœ°å€èª¿æ•´å› å­(åŸå¸‚1.2/é„‰æ‘0.9)
            const medicalInflation = 1.05;
            const areaFactor = 1.2; // é è¨­åŸå¸‚åœ°å€
            
            const remainingYears = expectedLife - age;
            const estimatedMedical = remainingYears * avgHospitalStayCost * avgHospitalStays * medicalInflation * areaFactor;
            const estimatedLTC = ltcYears * monthlyLTCcost * 12 * areaFactor;
            const totalEstimatedCost = estimatedMedical + estimatedLTC;
            const gap = totalEstimatedCost - currentMedicalLTCcoverage;

            document.getElementById('estimatedMedical').textContent = estimatedMedical.toLocaleString() + ' è¬å…ƒ';
            document.getElementById('estimatedLTC').textContent = estimatedLTC.toLocaleString() + ' è¬å…ƒ';
            document.getElementById('coveredAmount').textContent = currentMedicalLTCcoverage.toLocaleString() + ' è¬å…ƒ';
            document.getElementById('totalMedicalLTCGap').textContent = gap.toLocaleString() + ' è¬å…ƒ';

            const adviceDiv = document.getElementById('medicalAdvice');
            if (gap > 0) {
                adviceDiv.className = 'danger';
                adviceDiv.textContent = `âš ï¸ é†«ç™‚é•·ç…§ä¿éšœä¸è¶³ ${gap.toLocaleString()} è¬å…ƒï¼Œå»ºè­°å¢åŠ ç›¸é—œä¿éšªã€‚`;
            } else {
                adviceDiv.className = 'success';
                adviceDiv.textContent = `âœ… é†«ç™‚é•·ç…§ä¿éšœå……è¶³ï¼Œæ‚¨çš„é¢¨éšªç®¡ç†åšå¾—å¾ˆå¥½ï¼`;
            }
            adviceDiv.style.display = 'block';

            // å‰µå»º3Dåœ–è¡¨
            create3DMedicalChart(estimatedMedical, estimatedLTC, currentMedicalLTCcoverage);
        }

        function create3DMedicalChart(medical, ltc, coverage) {
            const container = document.getElementById('medical3DChart');
            container.innerHTML = '';

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.offsetWidth / container.offsetHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            
            renderer.setSize(container.offsetWidth, container.offsetHeight);
            renderer.setClearColor(0xf0f8ff);
            container.appendChild(renderer.domElement);

            // å‰µå»ºæŸ±ç‹€åœ–
            const maxValue = Math.max(medical, ltc, coverage);
            const scale = maxValue > 0 ? 5 / maxValue : 1;

            // é†«ç™‚è²»ç”¨æŸ±
            const medicalGeometry = new THREE.BoxGeometry(1, medical * scale, 1);
            const medicalMaterial = new THREE.MeshLambertMaterial({ color: 0xff6b6b });
            const medicalBar = new THREE.Mesh(medicalGeometry, medicalMaterial);
            medicalBar.position.set(-2, medical * scale / 2, 0);
            scene.add(medicalBar);

            // é•·ç…§è²»ç”¨æŸ±
            const ltcGeometry = new THREE.BoxGeometry(1, ltc * scale, 1);
            const ltcMaterial = new THREE.MeshLambertMaterial({ color: 0x4ecdc4 });
            const ltcBar = new THREE.Mesh(ltcGeometry, ltcMaterial);
            ltcBar.position.set(0, ltc * scale / 2, 0);
            scene.add(ltcBar);

            // ç¾æœ‰ä¿éšœæŸ±
            const coverageGeometry = new THREE.BoxGeometry(1, coverage * scale, 1);
            const coverageMaterial = new THREE.MeshLambertMaterial({ color: 0x45b7d1 });
            const coverageBar = new THREE.Mesh(coverageGeometry, coverageMaterial);
            coverageBar.position.set(2, coverage * scale / 2, 0);
            scene.add(coverageBar);

            // æ·»åŠ å…‰æº
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);

            camera.position.set(5, 3, 5);
            camera.lookAt(0, 0, 0);

            // å‹•ç•«å¾ªç’°
            function animate() {
                requestAnimationFrame(animate);
                
                // æ—‹è½‰å‹•ç•«
                medicalBar.rotation.y += 0.005;
                ltcBar.rotation.y += 0.005;
                coverageBar.rotation.y += 0.005;
                
                renderer.render(scene, camera);
            }
            animate();
        }

        // 3. ä¿è²»å¥åº·åº¦è¨ˆç®—
        function calculatePremiumHealth() {
            const income = parseFloat(document.getElementById('annualHouseholdIncome').value) || 0;
            const premium = parseFloat(document.getElementById('annualTotalPremium').value) || 0;
            
            if (income === 0) {
                document.getElementById('premiumPercentage').textContent = '0%';
                document.getElementById('premiumAdvice').textContent = 'è«‹è¼¸å…¥å®¶åº­å¹´ç¸½æ”¶å…¥ã€‚';
                return;
            }
            
            const percentage = (premium / income) * 100;
            document.getElementById('premiumPercentage').textContent = percentage.toFixed(1) + '%';
            
            const adviceDiv = document.getElementById('premiumAdvice');
            if (percentage < 10) {
                adviceDiv.className = 'warning';
                adviceDiv.textContent = 'âš ï¸ ä¿è²»ä½”æ¯”åä½ï¼Œå¯èƒ½ä¿éšœä¸è¶³ï¼Œå»ºè­°æª¢è¦–ä¿éšªè¦åŠƒã€‚';
            } else if (percentage >= 10 && percentage <= 15) {
                adviceDiv.className = 'success';
                adviceDiv.textContent = 'âœ… ä¿è²»ä½”æ¯”åœ¨å»ºè­°ç¯„åœå…§ï¼Œè²¡å‹™è¦åŠƒè‰¯å¥½ï¼';
            } else {
                adviceDiv.className = 'danger';
                adviceDiv.textContent = 'âš ï¸ ä¿è²»ä½”æ¯”åé«˜ï¼Œå¯èƒ½é€ æˆè²¡å‹™å£“åŠ›ï¼Œå»ºè­°å„ªåŒ–ä¿éšªé…ç½®ã€‚';
            }
        }

        function calculateCPV() {
            const premium = parseFloat(document.getElementById('policyA_premium').value) || 0;
            const coverage = parseFloat(document.getElementById('policyA_coverage').value) || 0;
            const scope = parseFloat(document.getElementById('policyA_scope').value) || 0;

            if (premium === 0) {
                document.getElementById('cpvScore').textContent = '0';
                return;
            }

            // ç°¡åŒ–CPå€¼è¨ˆç®—: (ä¿é¡ / å¹´ç¹³ä¿è²») * ä¿éšœç¯„åœä¿‚æ•¸ / 100
            const cpv = (coverage / premium) * scope / 10;
            document.getElementById('cpvScore').textContent = cpv.toFixed(2);

            const cpvBar = document.getElementById('cpvBar');
            const cpvPercentage = Math.min(cpv * 2, 100); // èª¿æ•´é¡¯ç¤ºæ¯”ä¾‹
            cpvBar.style.width = cpvPercentage + '%';

            const adviceDiv = document.getElementById('cpvAdvice');
            if (cpv >= 15) {
                cpvBar.style.background = 'linear-gradient(90deg, #4CAF50, #45a049)';
                cpvBar.textContent = `å„ªç§€ CPå€¼: ${cpv.toFixed(2)}`;
                adviceDiv.className = 'success';
                adviceDiv.textContent = 'ğŸ† é€™å¼µä¿å–®çš„CPå€¼å¾ˆé«˜ï¼Œæ€§åƒ¹æ¯”å„ªç§€ï¼';
            } else if (cpv >= 10) {
                cpvBar.style.background = 'linear-gradient(90deg, #ffaa00, #ff8800)';
                cpvBar.textContent = `è‰¯å¥½ CPå€¼: ${cpv.toFixed(2)}`;
                adviceDiv.className = 'warning';
                adviceDiv.textContent = 'ğŸ‘ é€™å¼µä¿å–®çš„CPå€¼è‰¯å¥½ï¼Œç®—æ˜¯ä¸éŒ¯çš„é¸æ“‡ã€‚';
            } else {
                cpvBar.style.background = 'linear-gradient(90deg, #f44336, #d32f2f)';
                cpvBar.textContent = `å¾…æ”¹å–„ CPå€¼: ${cpv.toFixed(2)}`;
                adviceDiv.className = 'danger';
                adviceDiv.textContent = 'âš ï¸ é€™å¼µä¿å–®çš„CPå€¼åä½ï¼Œå»ºè­°æ¯”è¼ƒå…¶ä»–é¸é …ã€‚';
            }
        }

        // 4. ç¾é‡‘åƒ¹å€¼åˆ†æ
        function generateChartData() {
            const annualPremium = parseFloat(document.getElementById('annualPremium').value) || 0;
            const paymentYears = parseFloat(document.getElementById('paymentYears').value) || 0;
            const expectedReturnRate = (parseFloat(document.getElementById('expectedReturnRate').value) || 0) / 100;
            const inflationRate = (parseFloat(document.getElementById('inflationRate').value) || 0) / 100;
            const analysisYears = parseFloat(document.getElementById('analysisYears').value) || 20;

            // å¢å¼·ç‰ˆç¾é‡‘åƒ¹å€¼è¨ˆç®—ï¼šåŠ å…¥æ³¢å‹•ç‡æ¨¡æ“¬(Â±1%)å’Œç¨…å‹™å½±éŸ¿(0.8)
            const volatility = 0.01;
            const taxFactor = 0.8;
            
            const labels = [];
            const cumulativePremiums = [];
            const cashValues = [];
            const realCashValues = [];
            const worstCaseValues = [];
            const bestCaseValues = [];

            let currentCumulativePremium = 0;
            let currentCashValue = 0;

            for (let year = 1; year <= analysisYears; year++) {
                labels.push(`ç¬¬${year}å¹´`);

                // ç´¯ç©ä¿è²»è¨ˆç®—
                if (year <= paymentYears) {
                    currentCumulativePremium += annualPremium;
                }
                cumulativePremiums.push(currentCumulativePremium);

                // ç¾é‡‘åƒ¹å€¼è¨ˆç®— (ç°¡åŒ–è¤‡åˆ©è¨ˆç®—)
                if (year <= paymentYears) {
                    currentCashValue = (currentCashValue + annualPremium) * (1 + expectedReturnRate);
                } else {
                    currentCashValue = currentCashValue * (1 + expectedReturnRate);
                }
                cashValues.push(currentCashValue);

                // é€šè†¨èª¿æ•´å¾Œçš„å¯¦è³ªç¾é‡‘åƒ¹å€¼
                const realValue = currentCashValue / Math.pow((1 + inflationRate), year);
                realCashValues.push(realValue);
            }

            // æ›´æ–°çµæœé¡¯ç¤º
            const totalPaid = paymentYears * annualPremium;
            const finalCash = cashValues[cashValues.length - 1];
            const finalReal = realCashValues[realCashValues.length - 1];
            const roi = totalPaid > 0 ? ((finalCash - totalPaid) / totalPaid * 100) : 0;

            document.getElementById('totalPremiumPaid').textContent = totalPaid.toLocaleString() + ' è¬å…ƒ';
            document.getElementById('finalCashValue').textContent = finalCash.toFixed(0).toLocaleString() + ' è¬å…ƒ';
            document.getElementById('realValue').textContent = finalReal.toFixed(0).toLocaleString() + ' è¬å…ƒ';
            document.getElementById('roi').textContent = roi.toFixed(2) + '%';

            // ç¹ªè£½åœ–è¡¨
            const ctx = document.getElementById('cashValueChart').getContext('2d');

            if (cashValueChart) {
                cashValueChart.destroy();
            }

            cashValueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ç´¯ç©ç¸½ç¹³ä¿è²»',
                            data: cumulativePremiums,
                            borderColor: '#36A2EB',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.4,
                            fill: false,
                            pointRadius: 3,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'ä¿å–®ç¾é‡‘åƒ¹å€¼ (åç›®å€¼)',
                            data: cashValues,
                            borderColor: '#FF6384',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.4,
                            fill: false,
                            pointRadius: 3,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'ç¾é‡‘åƒ¹å€¼ (é€šè†¨èª¿æ•´å¾Œ)',
                            data: realCashValues,
                            borderColor: '#4BC0C0',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderDash: [5, 5],
                            pointRadius: 3,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¿å–®ç¾é‡‘åƒ¹å€¼æˆé•·åˆ†æ',
                            font: { size: 18, weight: 'bold' }
                        },
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: '#667eea',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + 
                                           context.parsed.y.toFixed(0).toLocaleString() + ' è¬å…ƒ';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é‡‘é¡ (è¬å…ƒ)',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' è¬';
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'å¹´åº¦',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç¢ºä¿Chart.jså·²åŠ è¼‰
            if (typeof Chart !== 'undefined') {
                calculateDIME();
                calculateMedicalLTC();
                calculatePremiumHealth();
                calculateCPV();
                generateChartData();
            } else {
                console.error('Chart.jsæœªæ­£ç¢ºåŠ è¼‰');
            }

            // æ·»åŠ è¦–çª—èª¿æ•´äº‹ä»¶ç›£è½å™¨
            window.addEventListener('resize', function() {
                if (dimeChart) dimeChart.resize();
                if (cashValueChart) cashValueChart.resize();
            });
        });

        // æ·»åŠ ä¸€äº›å‹•ç•«æ•ˆæœ
        function addAnimationEffects() {
            const cards = document.querySelectorAll('.tool-card');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            });

            cards.forEach((card) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
        }

        // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œå‹•ç•«
        window.addEventListener('load', addAnimationEffects);

        // æ•¸å­—å‹•ç•«æ•ˆæœ
        function animateNumber(element, finalValue, duration = 1000) {
            const startValue = 0;
            const startTime = performance.now();
            
            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentValue = startValue + (finalValue - startValue) * progress;
                element.textContent = Math.round(currentValue).toLocaleString();
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        // æ·»åŠ è¼¸å…¥é©—è­‰
        function validateInputs() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value < 0) {
                        this.value = 0;
                        this.style.borderColor = '#f44336';
                        setTimeout(() => {
                            this.style.borderColor = '#e2e8f0';
                        }, 2000);
                    }
                });
            });
        }

        // åŸ·è¡Œè¼¸å…¥é©—è­‰
        document.addEventListener('DOMContentLoaded', validateInputs);

        // æ·»åŠ éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        switchTab(0);
                        break;
                    case '2':
                        e.preventDefault();
                        switchTab(1);
                        break;
                    case '3':
                        e.preventDefault();
                        switchTab(2);
                        break;
                    case '4':
                        e.preventDefault();
                        switchTab(3);
                        break;
                }
            }
        });

        // æ·»åŠ å·¥å…·æç¤ºåŠŸèƒ½
        function addTooltips() {
            const tooltips = {
                'debt': 'åŒ…å«æˆ¿è²¸ã€è»Šè²¸ã€ä¿¡ç”¨å¡å‚µå‹™ç­‰æ‰€æœ‰è² å‚µ',
                'incomeYears': 'å»ºè­°ä¿éšœ5-10å¹´çš„å®¶åº­ç”Ÿæ´»é–‹æ”¯',
                'education': 'é ä¼°å­å¥³å¾å¹¼ç¨šåœ’åˆ°å¤§å­¸çš„ç¸½æ•™è‚²è²»ç”¨',
                'age': 'è«‹è¼¸å…¥è¢«ä¿éšªäººç›®å‰å¹´é½¡',
                'expectedLife': 'æ ¹æ“šåœ‹äººå¹³å‡å£½å‘½ï¼Œå»ºè­°è¨­ç‚º80-85æ­²',
                'ltcYears': 'çµ±è¨ˆé¡¯ç¤ºå¹³å‡éœ€è¦é•·ç…§ç´„7-10å¹´',
                'monthlyLTCcost': 'åŒ…å«çœ‹è­·è²»ã€é†«ç™‚è²»ç­‰ï¼ŒåŸå¸‚ç´„3-5è¬/æœˆ'
            };

            Object.keys(tooltips).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.title = tooltips[id];
                    element.addEventListener('mouseenter', function() {
                        this.style.borderColor = '#667eea';
                    });
                    element.addEventListener('mouseleave', function() {
                        this.style.borderColor = '#e2e8f0';
                    });
                }
            });
        }

        // åŸ·è¡Œå·¥å…·æç¤ºåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', addTooltips);

        // æ·»åŠ æ•¸æ“šå°å‡ºåŠŸèƒ½
        function exportData() {
            const data = {
                dimeAnalysis: {
                    debt: document.getElementById('debt').value,
                    incomeYears: document.getElementById('incomeYears').value,
                    annualIncome: document.getElementById('annualIncome').value,
                    mortgage: document.getElementById('mortgage').value,
                    education: document.getElementById('education').value,
                    currentLifeInsurance: document.getElementById('currentLifeInsurance').value,
                    totalDemand: document.getElementById('totalDemand').textContent,
                    gap: document.getElementById('gap').textContent
                },
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'ä¿éšªåˆ†æå ±å‘Š_' + new Date().toISOString().slice(0,10) + '.json';
            link.click();
        }

        // æ·»åŠ åˆ—å°åŠŸèƒ½
        function printReport() {
            const printContent = document.querySelector('.container').cloneNode(true);
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>ä¿éšªé‡åŒ–åˆ†æå ±å‘Š</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .tool-card { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; }
                        .chart-container { display: none; }
                        .chart-3d { display: none; }
                        h1 { color: #333; text-align: center; }
                        h2 { color: #667eea; border-bottom: 2px solid #667eea; }
                        .result-section { background: #f8f9ff; padding: 15px; margin: 10px 0; }
                        .result-item { display: flex; justify-content: space-between; margin: 5px 0; }
                        @media print { 
                            .tabs { display: none; }
                            .tab-content { display: block !important; }
                        }
                    </style>
                </head>
                <body>
                    ${printContent.innerHTML}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }

        // æ·»åŠ åˆ†äº«åŠŸèƒ½
        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'ä¿éšªé‡åŒ–åˆ†æçµæœ',
                    text: 'æŸ¥çœ‹æˆ‘çš„ä¿éšªåˆ†æå ±å‘Š',
                    url: window.location.href
                });
            } else {
                // è¤‡è£½éˆæ¥åˆ°å‰ªè²¼æ¿
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('éˆæ¥å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
                });
            }
        }

        // æ·»åŠ æš—é»‘æ¨¡å¼åˆ‡æ›
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // æ¢å¾©æš—é»‘æ¨¡å¼è¨­ç½®
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
        });
    </script>
</body>
</html>
